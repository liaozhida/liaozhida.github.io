---
layout:     post
title:      "Python实战: 将博客自动上传到各大中文博客平台" 
date:       2017-05-22 12:00:00
author:     "zhida"
header-img: "img/post-bg-snow.jpg"
tags:
    - python
---

## 背景介绍
为了更好的掌握Python这门语言，自己开了一个项目专门用来实战，主要的功能是:遍历 jekyll文件夹的博客，对文件进行简单的处理,然后程序自动登录各大博客平台，发布文章
[项目地址](https://github.com/liaozhida/jekyll-blog-auto-upload.git) , 目前只完成了 segmentfaul 的站点，后续会增加其他博客平台的支持。

## 主要流程

#### 文件处理

```
def dirCb(self, dirname):
	for line in os.listdir(dirname):
		filename = os.path.abspath(os.path.join(dirname, line))
		if (os.path.isdir(filename)):
			self.dirCb(filename)
		else:
			pattern = re.compile(r"(\d+)-(\d+)-(\d+)-(.{0,}.md)")
			result = pattern.findall(filename)
			if (len(result) != 0):
				tags = filename.split('_posts')[1]
				# print tags
				tagname = ''
				for tag in tags.split(os.sep):
					if (tag != '' and len(pattern.findall(tag)) == 0):
						tagname = tagname + '|' + tag
				tagname = tagname[1:]
				self.filenameList[filename] = tagname
```

#### 登录

```
	def login(self):
		res = ''
		while (res == ''):
			try:
				data = self._prepare_login_form_data()
				res = self._session.post(self.loginUrl, data=data, timeout=10)
				print res
				if (res.status_code == 200):
					self.saveHeader()
					print 'login succ'
					return 0
				else:
					print 'login fail'
			
			except ValueError, e:
				print e
				print 'use cached login is succ'
				return 'succ'
			except requests.exceptions.ConnectionError:
				print 'requests.exceptions.ConnectionError  try again'
				time.sleep(2)
				print 'sleep over'
				continue
	
	def _prepare_login_form_data(self):
		
		# 封装返回数据
		form = {
			'username': str(self.username),
			'password': str(self.password),
			'remember': "1"
		}
		print form
		return form
```

#### 获取标签信息

#### 保存草稿

#### 发布文章

#### 文章清单


## 遇到的问题




