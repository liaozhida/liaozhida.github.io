


help = new Help();主要原因就是这个操作不是原子性的，从而留给了JVM重排序的机会。JVM的重排序也是有原则的，在单线程中，不管怎么排，保证最终结果一致。注意是单线程。多线程的情况下指令重排序就会给程序员带来问题。

help = new Help()这个操作可以拆成：

- 1、栈内存开辟空间给help引用
- 2、堆内存开辟空间准备初始化对象
- 3、初始化对象
- 4、栈中引用指向这个堆内存空间地址

指令重排之后可能会是1、2、4、3；这样重排之后对单个线程来说效果是一样的，所以JVM认为是合法的重排序，但是在多线程环境下就会出问题，这里到4的时候help已经指向了一块堆内存！=null ，只是这块堆内存还没初始化就直接返回了，使用的时候抛NullPointException。

作者：pqpo
链接：https://www.zhihu.com/question/35268028/answer/62016374
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。