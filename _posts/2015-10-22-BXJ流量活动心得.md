变形计-流量活动.md

#### Nginx

- 轮询机制，不一定会自动剔除故障机子（程序异常，主机宕机）

如果负载均衡中其中web2发生这样的情况，nginx首先会去web1请求，但是nginx在配置不当的情况下会继续分发请求道web2，然后等待web2响应，直到我们的响应时间超时，才会把请求重新分发给web1，这里的响应时间如果过长，用户等待的时间就会越长。

```
proxy_connect_timeout 1; #nginx服务器与被代理的服务器建立连接的超时时间，默认60秒
proxy_read_timeout 1; #nginx服务器想被代理服务器组发出read请求后，等待响应的超时间，默认为60秒。
proxy_send_timeout 1; #nginx服务器想被代理服务器组发出write请求后，等待响应的超时间，默认为60秒。
proxy_ignore_client_abort on; #客户端断网时，nginx服务器是否终端对被代理服务器的请求。默认为off。

```
[Nginx代理功能详解](http://www.jianshu.com/p/c623c72ebad8)

- 超时时间设置：当存在接口卡住，如果不设置超时时间，将会导致页面长时间无法打开，当意识到接口不稳定，应该设置较短的值，尽快转发到正常的主机。

- 增加静态缓存页面。

#### 前端

- 减少Loading图案，优先显示网页资源

- 请求接口失败，不要弹出错误框，宁愿数据没有变动

- 请求接口失败，应发起重试，直到请求成功，请求超时时间设置2s，2s没有返回的请求根本没有继续等待的必要，重试成功的概率比较高
 
- 接口数据缓存化

#### 阿里云

- API监控预警，设置尽可能多的接口进行监测
- 所有主机的监控要设置 `最低值`和`最高值`，防止宕机
- 

#### 数据库

- mongo虽然是文档性内存数据库，但是在高IO的情况下不稳定，页面的数据要定时缓存到redis进行处理
- 数据库连接和访问要设置超时时间，这点避免阻塞。
- 关于自建数据库，公司有钱就尽量在云端买。。。
- Mongo瓶颈问题:详情看 mongo调优.md
	- 通过查看mongo性能指标是否是数据问题
	- 检查程序中间件，适当设置超时时间等，

首页接口 索引  缓存  sql优化

索引 读写分离

#### 可用性和体验

h5 loading
重试对服务器的压力
docker的稳定性
mongo io redis

