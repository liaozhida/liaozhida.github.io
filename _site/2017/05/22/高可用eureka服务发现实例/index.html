<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>高可用eureka服务发现实例 - Paraller的博客 | Paraller's Blog</title>

    <link rel="canonical" href="http://localhost:4000/2017/05/22/%E9%AB%98%E5%8F%AF%E7%94%A8eureka%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%AE%9E%E4%BE%8B/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>




<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Paraller's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-2015.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/post-bg-2015.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#eureka" title="eureka">eureka</a>
                        
                        <a class="tag" href="/tags/#微服务 & 分布式 & 架构" title="微服务 & 分布式 & 架构">微服务 & 分布式 & 架构</a>
                        
                    </div>
                    <h1>高可用eureka服务发现实例</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by zhida.liao on May 22, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<p>基于spring cloud 的案例进行自定义配置</p>

<h2 id="简介">简介</h2>

<p>一个注册发现服务，类似于一个 Map数据结构保存了 实例名和 相应的域名信息，提供实例注册和返回。（保存在内存中	）</p>

<p>The Eureka server does not have a backend store, but the service instances in the registry all have to send heartbeats to keep their registrations up to date (so this can be done in memory).
Clients also have an in-memory cache of eureka registrations (so they don’t have to go to the registry for every single request to a service).</p>

<h2 id="实现">实现</h2>

<h3 id="服务端配置">服务端配置</h3>

<h5 id="applicationjava">Application.java</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>@SpringBootApplication
@EnableEurekaServer
public class EurekaApplication {

	public static void main(String[] args) throws Exception {
		SpringApplication.run(EurekaApplication.class, args);
	}

} 
</code></pre>
</div>

<h5 id="配置1推荐-applicationyml">配置1(推荐): application.yml</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>spring:
  application:
    name: eureka-server-clustered1
  profiles: peer1				# 激活环境配置文件
server:
  port: 9761
  host: serverA
eureka:
  instance:
    hostname: eureka-peer1
    preferIpAddress: true
    instance-id: ${spring.cloud.client.ipAddress}:${server.port}:${spring.application.name}
  client:
    registerWithEureka: true	# 是否要发现服务中注册该程序	
    fetchRegistry: true			# 是否可以获取服务信息
    serviceUrl:					# 在该列表中注册该程序
      defaultZone: http://${server.host}:9762/eureka/,http://${server.host}:9763/eureka/

---
spring:
  application:
    name: eureka-server-clustered2
  profiles: peer2
server:
  port: 9762
  host: serverA
eureka:
  instance:
    hostname: eureka-peer2
    preferIpAddress: true
    instance-id: ${spring.cloud.client.ipAddress}:${server.port}:${spring.application.name}
  client:
    registerWithEureka: true
    fetchRegistry: true
    serviceUrl:
      defaultZone: http://${server.host}:9761/eureka/,http://${server.host}:9763/eureka/

---
spring:
  application:
    name: eureka-server-clustered3
  profiles: peer3
server:
  port: 9763
  host: serverA
eureka:
  instance:
    hostname: eureka-peer3
    preferIpAddress: true
    instance-id: ${spring.cloud.client.ipAddress}:${server.port}:${spring.application.name}
  client:
    registerWithEureka: true
    fetchRegistry: true
    serviceUrl:
      defaultZone: http://${server.host}:9761/eureka/,http://${server.host}:9762/eureka/
</code></pre>
</div>

<h5 id="配置2-applicationproperties">配置2: application.properties</h5>

<p>application-peer1.properties</p>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka.client.fetchRegistry=true
eureka.client.registerWithEureka=true
eureka.client.serviceUrl.defaultZone=http\://serverA\:9762/eureka/,http\://serverA\:9763/eureka/
eureka.instance.hostname=serverA
eureka.instance.metadataMap.instanceId=${spring.application.name}\:${spring.application.instance_id\:${random.value}}
eureka.server.waitTimeInMsWhenSyncEmpty=0
server.port=9761
spring.application.name=server_peer1

</code></pre>
</div>
<p>application-peer2.properties</p>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka.client.fetchRegistry=true
eureka.client.registerWithEureka=true
eureka.client.serviceUrl.defaultZone=http\://serverA\:9761/eureka/,http\://serverA\:9763/eureka/
eureka.instance.hostname=serverA
eureka.server.waitTimeInMsWhenSyncEmpty=0
server.port=9762
eureka.instance.metadataMap.instanceId=${spring.application.name}\:${spring.application.instance_id\:${random.value}}
spring.application.name=server_peer2

</code></pre>
</div>

<p>application-peer3.properties</p>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka.client.fetchRegistry=true
eureka.client.registerWithEureka=true
eureka.client.serviceUrl.defaultZone=http\://serverA\:9761/eureka/,http\://serverA\:9762/eureka/
eureka.instance.hostname=serverA
eureka.server.waitTimeInMsWhenSyncEmpty=0
server.port=9763
eureka.instance.metadataMap.instanceId=${spring.application.name}\:${spring.application.instance_id\:${random.value}}
spring.application.name=server_peer3

</code></pre>
</div>

<h5 id="本地跑测试的时候需要编辑-etchosts">本地跑测试的时候，需要编辑 etc/hosts</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>127.0.0.1 	serverA
</code></pre>
</div>

<h5 id="dockerfile-文件">Dockerfile 文件</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>FROM java:7
VOLUME /tmp
ADD eureka-0.0.1-SNAPSHOT.jar /app.jar
RUN bash -c 'touch /app.jar'
EXPOSE 9762
ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]

</code></pre>
</div>

<h5 id="pomxml">pom.xml</h5>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

	<span class="nt">&lt;groupId&gt;</span>org.demo<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>eureka<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

	<span class="nt">&lt;name&gt;</span>Eureka Server<span class="nt">&lt;/name&gt;</span>
	<span class="nt">&lt;description&gt;</span>Eureka Server demo project<span class="nt">&lt;/description&gt;</span>

	<span class="nt">&lt;parent&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;version&gt;</span>1.4.3.RELEASE<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;relativePath</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/parent&gt;</span>


	<span class="nt">&lt;properties&gt;</span>
		<span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
		<span class="c">&lt;!-- springBoot 程序的主入口 --&gt;</span>
		<span class="nt">&lt;start-class&gt;</span>eurekademo.EurekaApplication<span class="nt">&lt;/start-class&gt;</span> 
		<span class="nt">&lt;java.version&gt;</span>1.7<span class="nt">&lt;/java.version&gt;</span>
		<span class="nt">&lt;docker.registry&gt;</span>docker.umiit.cn:5043<span class="nt">&lt;/docker.registry&gt;</span>

	<span class="nt">&lt;/properties&gt;</span>

	<span class="nt">&lt;profiles&gt;</span>
		<span class="nt">&lt;profile&gt;</span>
			<span class="nt">&lt;id&gt;</span>dev<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;properties&gt;</span>
				<span class="nt">&lt;env&gt;</span>dev<span class="nt">&lt;/env&gt;</span>
			<span class="nt">&lt;/properties&gt;</span>
			<span class="nt">&lt;activation&gt;</span>
				<span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
			<span class="nt">&lt;/activation&gt;</span>
		<span class="nt">&lt;/profile&gt;</span>
		<span class="nt">&lt;profile&gt;</span>
			<span class="nt">&lt;id&gt;</span>peer1<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;properties&gt;</span>
				<span class="nt">&lt;env&gt;</span>peer1<span class="nt">&lt;/env&gt;</span>
				<span class="nt">&lt;docker&gt;</span>peer1<span class="nt">&lt;/docker&gt;</span>
			<span class="nt">&lt;/properties&gt;</span>
		<span class="nt">&lt;/profile&gt;</span>
		<span class="nt">&lt;profile&gt;</span>
			<span class="nt">&lt;id&gt;</span>peer2<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;properties&gt;</span>
				<span class="nt">&lt;env&gt;</span>peer2<span class="nt">&lt;/env&gt;</span>
				<span class="nt">&lt;docker&gt;</span>peer2<span class="nt">&lt;/docker&gt;</span>
			<span class="nt">&lt;/properties&gt;</span>
		<span class="nt">&lt;/profile&gt;</span>
		<span class="nt">&lt;profile&gt;</span>
			<span class="nt">&lt;id&gt;</span>peer3<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;properties&gt;</span>
				<span class="nt">&lt;env&gt;</span>peer3<span class="nt">&lt;/env&gt;</span>
				<span class="nt">&lt;docker&gt;</span>peer3<span class="nt">&lt;/docker&gt;</span>
			<span class="nt">&lt;/properties&gt;</span>
		<span class="nt">&lt;/profile&gt;</span>
	<span class="nt">&lt;/profiles&gt;</span>

	<span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-eureka-server<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.3.0.RELEASE<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; 
			&lt;/dependency&gt; --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;/dependencies&gt;</span>

	<span class="nt">&lt;dependencyManagement&gt;</span>
		<span class="nt">&lt;dependencies&gt;</span>
			<span class="nt">&lt;dependency&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>Camden.SR6<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
				<span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
			<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;/dependencies&gt;</span>
	<span class="nt">&lt;/dependencyManagement&gt;</span>



	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>com.spotify<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>docker-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>0.2.11<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;pushImage&gt;</span>true<span class="nt">&lt;/pushImage&gt;</span>
					<span class="nt">&lt;imageName&gt;</span>
						${docker.registry}/v3/${project.artifactId}:${docker}
					<span class="nt">&lt;/imageName&gt;</span>

					<span class="nt">&lt;dockerDirectory&gt;</span>src/main/resources_${env}/docker<span class="nt">&lt;/dockerDirectory&gt;</span>
					<span class="nt">&lt;resources&gt;</span>
						<span class="nt">&lt;resource&gt;</span>
							<span class="nt">&lt;targetPath&gt;</span>/<span class="nt">&lt;/targetPath&gt;</span>
							<span class="nt">&lt;directory&gt;</span>${project.build.directory}<span class="nt">&lt;/directory&gt;</span>
							<span class="nt">&lt;include&gt;</span>${project.build.finalName}.jar<span class="nt">&lt;/include&gt;</span>
						<span class="nt">&lt;/resource&gt;</span>
					<span class="nt">&lt;/resources&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="c">&lt;!-- defined in spring-cloud-starter-parent pom (as documentation hint), 
					but needs to be repeated here --&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;requiresUnpack&gt;</span>
						<span class="nt">&lt;dependency&gt;</span>
							<span class="nt">&lt;groupId&gt;</span>com.netflix.eureka<span class="nt">&lt;/groupId&gt;</span>
							<span class="nt">&lt;artifactId&gt;</span>eureka-core<span class="nt">&lt;/artifactId&gt;</span>
						<span class="nt">&lt;/dependency&gt;</span>
						<span class="nt">&lt;dependency&gt;</span>
							<span class="nt">&lt;groupId&gt;</span>com.netflix.eureka<span class="nt">&lt;/groupId&gt;</span>
							<span class="nt">&lt;artifactId&gt;</span>eureka-client<span class="nt">&lt;/artifactId&gt;</span>
						<span class="nt">&lt;/dependency&gt;</span>
					<span class="nt">&lt;/requiresUnpack&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>pl.project13.maven<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>git-commit-id-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;failOnNoGitDirectory&gt;</span>false<span class="nt">&lt;/failOnNoGitDirectory&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="c">&lt;!--skip deploy (this is just a test module) --&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>build-helper-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;executions&gt;</span>
					<span class="nt">&lt;execution&gt;</span>
						<span class="nt">&lt;id&gt;</span>add-resource<span class="nt">&lt;/id&gt;</span>
						<span class="nt">&lt;phase&gt;</span>initialize<span class="nt">&lt;/phase&gt;</span>
						<span class="nt">&lt;goals&gt;</span>
							<span class="nt">&lt;goal&gt;</span>add-resource<span class="nt">&lt;/goal&gt;</span>
						<span class="nt">&lt;/goals&gt;</span>
						<span class="nt">&lt;configuration&gt;</span>
							<span class="nt">&lt;resources&gt;</span>
								<span class="nt">&lt;resource&gt;</span>
									<span class="nt">&lt;directory&gt;</span>src/main/resources_${env}<span class="nt">&lt;/directory&gt;</span>
								<span class="nt">&lt;/resource&gt;</span>
							<span class="nt">&lt;/resources&gt;</span>
						<span class="nt">&lt;/configuration&gt;</span>
					<span class="nt">&lt;/execution&gt;</span>
				<span class="nt">&lt;/executions&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>

	<span class="nt">&lt;repositories&gt;</span>
		<span class="nt">&lt;repository&gt;</span>
			<span class="nt">&lt;id&gt;</span>spring-snapshots<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;name&gt;</span>Spring Snapshots<span class="nt">&lt;/name&gt;</span>
			<span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-snapshot-local<span class="nt">&lt;/url&gt;</span>
			<span class="nt">&lt;snapshots&gt;</span>
				<span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
			<span class="nt">&lt;/snapshots&gt;</span>
		<span class="nt">&lt;/repository&gt;</span>
		<span class="nt">&lt;repository&gt;</span>
			<span class="nt">&lt;id&gt;</span>spring-milestones<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;name&gt;</span>Spring Milestones<span class="nt">&lt;/name&gt;</span>
			<span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-milestone-local<span class="nt">&lt;/url&gt;</span>
			<span class="nt">&lt;snapshots&gt;</span>
				<span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
			<span class="nt">&lt;/snapshots&gt;</span>
		<span class="nt">&lt;/repository&gt;</span>
		<span class="nt">&lt;repository&gt;</span>
			<span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;name&gt;</span>Spring Releases<span class="nt">&lt;/name&gt;</span>
			<span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-release-local<span class="nt">&lt;/url&gt;</span>
			<span class="nt">&lt;snapshots&gt;</span>
				<span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
			<span class="nt">&lt;/snapshots&gt;</span>
		<span class="nt">&lt;/repository&gt;</span>
	<span class="nt">&lt;/repositories&gt;</span>
	<span class="nt">&lt;pluginRepositories&gt;</span>
		<span class="nt">&lt;pluginRepository&gt;</span>
			<span class="nt">&lt;id&gt;</span>spring-snapshots<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;name&gt;</span>Spring Snapshots<span class="nt">&lt;/name&gt;</span>
			<span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-snapshot-local<span class="nt">&lt;/url&gt;</span>
			<span class="nt">&lt;snapshots&gt;</span>
				<span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
			<span class="nt">&lt;/snapshots&gt;</span>
		<span class="nt">&lt;/pluginRepository&gt;</span>
		<span class="nt">&lt;pluginRepository&gt;</span>
			<span class="nt">&lt;id&gt;</span>spring-milestones<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;name&gt;</span>Spring Milestones<span class="nt">&lt;/name&gt;</span>
			<span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-milestone-local<span class="nt">&lt;/url&gt;</span>
			<span class="nt">&lt;snapshots&gt;</span>
				<span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
			<span class="nt">&lt;/snapshots&gt;</span>
		<span class="nt">&lt;/pluginRepository&gt;</span>
	<span class="nt">&lt;/pluginRepositories&gt;</span>

<span class="nt">&lt;/project&gt;</span>

</code></pre>
</div>

<h5 id="gitlab-ciyml">.gitlab-ci.yml</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>image: docker.umiit.cn:5043/maven_docker:latest

stages:
  - build

run_build_peer1:
  stage: build
  tags:
    - docker
  only:
    - develop
  script:   
    - mvn clean package docker:build -Ppeer1

run_build_peer2:
  stage: build
  tags:
    - docker
  only:
    - develop
  script:   
    - mvn clean package docker:build -Ppeer2

run_build_peer3:
  stage: build
  tags:
    - docker
  only:
    - develop
  script:   
    - mvn clean package docker:build -Ppeer3

</code></pre>
</div>

<h5 id="docker-composeyml">docker-compose.yml</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>eureka_1:
  image: docker.umiit.cn:5043/v3/eureka:peer1
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /mnt/docker-data/logstash/eureka_1:/usr/local/tomcat/logs
  environment:
    spring.profiles.active: peer1
  ports:
    - "公网IP:9761:9761"
eureka_2:
  image: docker.umiit.cn:5043/v3/eureka:peer2
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /mnt/docker-data/logstash/eureka_2:/usr/local/tomcat/logs
  environment:
    spring.profiles.active: peer2
  ports:
    - "公网IP:9762:9762"
eureka_3:
  image: docker.umiit.cn:5043/v3/eureka:peer3
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /mnt/docker-data/logstash/eureka_2:/usr/local/tomcat/logs
  environment:
    spring.profiles.active: peer3
  ports:
    - "公网IP:9763:9763"
</code></pre>
</div>

<h5 id="项目结构">项目结构</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>|-- src/main/resources_peer1 
|-- src/main/resources_peer2 
|-- src/main/resources_peer3

# 放置 Dockerfile &amp; application.yml
</code></pre>
</div>

<h5 id="本地测试">本地测试</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>mvn package

java -jar eureka-server-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer1
java -jar eureka-server-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer2
java -jar eureka-server-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer3
</code></pre>
</div>

<h3 id="客户端配置">客户端配置</h3>

<h5 id="applicationyml">application.yml</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>server:
  port: ${vcap.application.port:9099}
  
eureka:
  instance:
    preferIpAddress: true
  client:
    serviceUrl:
      defaultZone: http://${serverA}:9761/eureka/,http://${serverA}:9762/eureka/,http://${serverA}:9763/eureka/
    registerWithEureka: true
    fetchRegistry: true

</code></pre>
</div>

<h5 id="docker-composeyml-1">docker-compose.yml</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>ticketservice:
  image: docker.umiit.cn:5043/v3/ticket-service:prep
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /mnt/docker-data/logstash/ticketservice:/logs
  external_links:
    - common_mysql_1:mysqlDb
    - common_redis_1:redisDb
    - common_mongo_1:mongoDb
  environment:
    serverA: localhost
    JVM_ARGS: -Xmx1024m
  ports:
    - "0.0.0.0:9099:9099"
yeaservice:
  image: docker.umiit.cn:5043/v3/yea-service:ipc
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /mnt/docker-data/logstash/yeaservice:/logs
  external_links:
    - common_mysql_1:mysqlDb
    - common_redis_1:redisDb
    - common_mongo_1:mongoDb
  environment:
    serverA: localhost
    JVM_ARGS: -Xmx1024m
  ports:
    - "0.0.0.0:8081:8081"
hystrix-dashboard:
  image: kennedyoliveira/hystrix-dashboard
  ports:
    - "0.0.0.0:7979:7979"
  environment:
    JVM_ARGS: -Xmx512m
</code></pre>
</div>

<h5 id="yeaservice---applicationjava">yeaservice - Application.java</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>
@SpringBootApplication
@EnableEurekaClient
@EnableFeignClients
@EnableDiscoveryClient
@EnableCircuitBreaker
@EnableHystrixDashboard
@RibbonClient(name = "yea-ribbon", configuration = YeaRibbonConfiguration.class)
@ComponentScan(basePackages = { "com.**" })
public class Application {

	public static void main(String[] args) {
		SpringApplication.run(Application.class, args);
	}

}

</code></pre>
</div>

<h5 id="yeaservice---调用-ticketservice">yeaservice - 调用 ticketservice</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>
@FeignClient(value = "ticket-service")
interface TicketClient {
	
}

</code></pre>
</div>

<p>这里使用了Feign的框架演示。</p>

<h3 id="查看结果">查看结果</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>curl -i IP:9761/  # 在浏览器中输入网址
</code></pre>
</div>

<h2 id="官方知识点">官方知识点</h2>

<h3 id="authenticating-with-the-eureka-server">Authenticating with the Eureka Server</h3>

<p>HTTP basic authentication will be automatically added to your eureka client if one of the eureka.client.serviceUrl.defaultZone URLs has credentials embedded in it (curl style, like http://user:password@localhost:8761/eureka). For more complex needs you can create a @Bean of type DiscoveryClientOptionalArgs and inject ClientFilter instances into it, all of which will be applied to the calls from the client to the server.</p>

<h3 id="zones">Zones</h3>

<p>希望在不同的Zone中配置你的客户端，首先要确认你的Eureka servers 部署在不同的Zone中，并且互相连接了，接下来要告诉Server你的服务实例在哪里，你可以使用<code class="highlighter-rouge">metadataMap</code>属性,例如像下面这样配置：</p>

<h5 id="service-1-in-zone-1">Service 1 in Zone 1</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka.instance.metadataMap.zone = zone1
eureka.client.preferSameZoneEureka = true
</code></pre>
</div>

<h5 id="service-1-in-zone-2">Service 1 in Zone 2</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>eureka.instance.metadataMap.zone = zone2
eureka.client.preferSameZoneEureka = true
</code></pre>
</div>

<p>NOTE
Because of a limitation in Eureka it isn’t possible to support per-server basic auth credentials, so only the first set that are found will be used.</p>

<h3 id="单例模式">单例模式</h3>

<p>如果是单例模式的话，不必开启下面的选项，因为心跳检测会不断的进行，会报错连接不上。</p>
<div class="highlighter-rouge"><pre class="highlight"><code>eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false			## this
    fetchRegistry: false				## this	
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
</code></pre>
</div>

<h2 id="参考链接">参考链接</h2>

<p><a href="http://www.jiagoushuo.com/article/1000415.html">如何实现微服务架构中的服务发现</a></p>

<p><a href="https://spring.io/blog/2015/01/20/microservice-registration-and-discovery-with-spring-cloud-and-netflix-s-eureka">Microservice Registration and Discovery with Spring Cloud and Netflix’s Eureka</a></p>

<p><a href="http://blog.didispace.com/springcloud1/">Spring Cloud构建微服务架构（一）服务注册与发现</a></p>

<p><a href="http://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/1.2.7.RELEASE/">Spring Cloud Netflix</a></p>

<h2 id="qa">QA</h2>

<p><strong>使用serverA 的域名配置，修改宿主机的  /etc/hosts ，不能集群连接</strong></p>

<p>需要在docker容器中配置 /etc/hosts, 所以 vim Dockerfile</p>
<div class="highlighter-rouge"><pre class="highlight"><code>RUN echo '10.45.189.178 serverA' &gt;&gt; /etc/hosts
</code></pre>
</div>
<p>重新启动，发现还是无效，cat /etc/hosts 没有写进serverA 的映射，后面推测应该是容器的/etc/hosts是动态生成的，所以这个语句无效。
从环境变量开始入手
docker-compose.yml</p>
<div class="highlighter-rouge"><pre class="highlight"><code>environment:
serverA: 内网IP
</code></pre>
</div>



                <hr>

                
                <!-- 多说 Share start -->
                </style>
                <div class="ds-share"
                    style="text-align: right"
                    data-thread-key="/2017/05/22/高可用eureka服务发现实例"
                    data-title="高可用eureka服务发现实例"
                    data-url="http://localhost:4000/2017/05/22/%E9%AB%98%E5%8F%AF%E7%94%A8eureka%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%AE%9E%E4%BE%8B/"
                    data-images="http://localhost:4000/img/post-bg-2015.jpg"
                    data-content="基于spring cloud 的案例进行自定义配置

简介

一个注册发现服务，类似于一个 Map数据结构保存了 实例名和 相应的域名信息，提供实例注册和... | Paraller的博客 | Paraller's Blog " >
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">
                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- 多说 Share end-->
                


                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/05/22/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B-%E4%BD%BF%E7%94%A8Spring-Cloud-&-Eureka%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%92%8C%E6%B3%A8%E5%86%8C/" data-toggle="tooltip" data-placement="top" title="微服务教程-使用Spring Cloud&Eureka服务发现和注册">&larr; Previous Post</a>
                    </li>
                    
                    
                </ul>


                
                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread"
                        data-thread-key="/2017/05/22/高可用eureka服务发现实例"
                        data-title="高可用eureka服务发现实例"
                        data-url="http://localhost:4000/2017/05/22/%E9%AB%98%E5%8F%AF%E7%94%A8eureka%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%AE%9E%E4%BE%8B/" >
                    </div>
                </div>
                <!-- 多说评论框 end -->
                

                

            </div>

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#spring" title="spring" rel="7">
                                    spring
                                </a>
                            
        				
                            
                				<a href="/tags/#springSecurity" title="springSecurity" rel="2">
                                    springSecurity
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#数据库相关" title="数据库相关" rel="3">
                                    数据库相关
                                </a>
                            
        				
                            
                				<a href="/tags/#mongo" title="mongo" rel="3">
                                    mongo
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#hux" title="hux" rel="4">
                                    hux
                                </a>
                            
        				
                            
                				<a href="/tags/#linux" title="linux" rel="6">
                                    linux
                                </a>
                            
        				
                            
                				<a href="/tags/#运维 & 主机 & 系统搭建" title="运维 & 主机 & 系统搭建" rel="5">
                                    运维 & 主机 & 系统搭建
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#springBoot" title="springBoot" rel="2">
                                    springBoot
                                </a>
                            
        				
                            
                				<a href="/tags/#管理" title="管理" rel="4">
                                    管理
                                </a>
                            
        				
                            
                				<a href="/tags/#Jenkins" title="Jenkins" rel="2">
                                    Jenkins
                                </a>
                            
        				
                            
                				<a href="/tags/#编程习惯 & 思考" title="编程习惯 & 思考" rel="4">
                                    编程习惯 & 思考
                                </a>
                            
        				
                            
                				<a href="/tags/#并发编程" title="并发编程" rel="6">
                                    并发编程
                                </a>
                            
        				
                            
                				<a href="/tags/#学习笔记" title="学习笔记" rel="10">
                                    学习笔记
                                </a>
                            
        				
                            
                				<a href="/tags/#eureka" title="eureka" rel="4">
                                    eureka
                                </a>
                            
        				
                            
                				<a href="/tags/#微服务 & 分布式 & 架构" title="微服务 & 分布式 & 架构" rel="14">
                                    微服务 & 分布式 & 架构
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#zookeeper" title="zookeeper" rel="2">
                                    zookeeper
                                </a>
                            
        				
                            
                				<a href="/tags/#docker" title="docker" rel="7">
                                    docker
                                </a>
                            
        				
                            
                				<a href="/tags/#http" title="http" rel="2">
                                    http
                                </a>
                            
        				
                            
                				<a href="/tags/#Java" title="Java" rel="2">
                                    Java
                                </a>
                            
        				
                            
                				<a href="/tags/#安全" title="安全" rel="6">
                                    安全
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#jvm" title="jvm" rel="2">
                                    jvm
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://www.paraller.com">Paraller's Blog</a></li>
                    
                        <li><a href="https://segmentfault.com/u/paraller">segmentfault</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>


<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    // dynamic User by Hux
    var _user = 'blog';

    // duoshuo comment query.
    var duoshuoQuery = {short_name: _user };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/paraller-15">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/liaozhida">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Paraller's Blog 2017
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-106159397-1';
    var _gaDomain = 'www.paraller.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '29bd9c56c7cf57524dd2340ce2d7da2e';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
